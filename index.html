<!doctype html>
<html lang="ar-KW" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>المتجر الكويتي - أحدث المنتجات والعروض في الكويت</title>
    <meta name="description" content="اكتشف أفضل العروض على الإلكترونيات، الأدوات المنزلية، ومستلزمات العناية الشخصية في المتجر الكويتي. تسوق الآن واستمتع بأسعار تنافسية في الكويت.">
    <link rel="canonical" href="https://sherow1982.github.io/Kuwait-matjar/">
    <link rel="stylesheet" href="./woodmart-lite.css">
    <link rel="icon" href="./favicon.ico">
</head>
<body>
    <header class="header">
        <div class="header__inner container">
            <a href="/" class="header__logo"><h1>المتجر الكويتي</h1></a>
            <div class="header__spacer"></div>
            <nav class="main-nav">
                <a href="#why-us">لماذا تختارنا؟</a>
                <a href="/blog.html">المدونة</a>
            </nav>
        </div>
    </header>
    <main class="section">
        <div id="products-container" class="container">
            <h2>أحدث المنتجات</h2>
            <!-- سيتم حقن شبكة المنتجات هنا عبر JavaScript -->
        </div>
    </main>
    <section id="why-us" class="section features-section">
        <div class="container">
            <h2>لماذا تتسوق من المتجر الكويتي؟</h2>
            <div class="features-grid">
                <div class="feature-item"><h3>أسعار تنافسية</h3><p>نبحث لك عن أفضل الأسعار والعروض المتاحة في السوق الكويتي.</p></div>
                <div class="feature-item"><h3>توصيل سريع</h3><p>شحن سريع وموثوق إلى جميع مناطق الكويت.</p></div>
                <div class="feature-item"><h3>جودة مضمونة</h3><p>نختار المنتجات من موردين موثوقين لضمان أفضل جودة.</p></div>
            </div>
        </div>
    </section>
    <footer class="footer">
        <div class="container footer__bottom"><p>&copy; 2025 المتجر الكويتي - جميع الحقوق محفوظة</p></div>
    </footer>
    
    <script type="module">
        const DATA_URL = 'https://raw.githubusercontent.com/sherow1982/Kuwait-matjar/refs/heads/main/data/products-template.json?raw=1';
        const container = document.getElementById('products-container');

        const slugify = (text) => text ? text.toString().toLowerCase().trim().replace(/\s+/g, '-').replace(/[^\u0600-\u06FFa-z0-9-]/g, '').replace(/-+/g, '-') : '';
        const formatKD = (val) => typeof val === 'number' ? new Intl.NumberFormat('ar-KW', { style: 'currency', currency: 'KWD' }).format(val) : '';
        const parsePrice = (priceStr) => priceStr ? parseFloat(String(priceStr).replace(/[^0-9.]/g, '')) : null;

        const createProductCard = (p = {}) => {
            const title = p['العنوان'] || '';
            const image = p['رابط الصورة'] || '';
            const productSlug = slugify(title);
            const productPageLink = `./product.html?name=${productSlug}`;
            
            const salePriceNum = parsePrice(p['السعر المخفّض']);
            const regularPriceNum = parsePrice(p['السعر']);
            
            const currentPriceHTML = formatKD(salePriceNum || regularPriceNum);
            const oldPriceHTML = salePriceNum ? `<s>${formatKD(regularPriceNum)}</s>` : '';
            
            let saleBadge = '';
            if (salePriceNum && regularPriceNum && regularPriceNum > salePriceNum) {
                const discount = Math.round(((regularPriceNum - salePriceNum) / regularPriceNum) * 100);
                saleBadge = `<span class="product__badge">-${discount}%</span>`;
            }

            return `
                <div class="product">
                    <a href="${productPageLink}" target="_blank" rel="noopener noreferrer" class="product__media">
                        ${saleBadge}
                        <img src="${image}" alt="${title}" loading="lazy" decoding="async">
                    </a>
                    <div class="product__body">
                        <h3 class="product__title">
                            <a href="${productPageLink}" target="_blank" rel="noopener noreferrer">${title}</a>
                        </h3>
                        <div class="price">
                            ${oldPriceHTML}
                            <span>${currentPriceHTML}</span>
                        </div>
                    </div>
                </div>
            `;
        };
      
        const renderProducts = (items) => {
            const productsGrid = document.createElement('div');
            productsGrid.className = 'products';
            if (items?.length) {
                productsGrid.innerHTML = items.map(createProductCard).join('');
            } else {
                productsGrid.innerHTML = '<p>عفواً، لم يتم العثور على منتجات حالياً.</p>';
            }
            container.appendChild(productsGrid);
        };

        (async () => {
            try {
                const res = await fetch(DATA_URL);
                if (!res.ok) throw new Error('فشل تحميل المنتجات');
                const items = await res.json();
                renderProducts(items);
            } catch (error) {
                console.error(error);
                if (container) container.innerHTML += '<p>حدث خطأ أثناء تحميل المنتجات.</p>';
            }
        })();
    </script>
</body>
</html>
